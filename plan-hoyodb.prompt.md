# 计划：HOYODB 米哈游游戏素材数据库网站

构建一个基于 Web 的米哈游游戏素材展示和下载平台，优先支持《崩坏：星穹铁道》，后续扩展至原神和绝区零。文件存储通过 OpenList 对接中国移动云盘，仅管理员可上传内容，普通用户仅可浏览和下载。

## 步骤

1. **初始化项目基础架构** - 创建前后端分离结构，前端使用 React/Vue，后端使用 Node.js + Express + TypeScript，数据库使用 PostgreSQL/MySQL 存储元数据

2. **设计素材分类体系** - 按游戏划分（星铁/原神/绝区零），每个游戏下分类：角色语音、BGM音乐、战斗音效、角色立绘、场景原画、UI素材、过场动画、版本资源包

3. **集成 OpenList 云盘存储** - 研究并接入 OpenList API，实现文件上传到中国移动云盘、获取分享链接、文件管理等功能

4. **开发管理员上传系统** - 创建管理员认证（简单的账号密码或 token），上传界面支持批量上传、自动提取文件元信息、设置分类标签和描述

5. **构建用户浏览前端** - 开发首页、游戏分类页、素材列表页（支持筛选/搜索）、素材详情页（展示预览、信息、下载按钮）

6. **实现下载和预览功能** - 音频文件支持在线播放器、图片支持预览和灯箱、提供下载链接（直连云盘或代理下载）

## 进一步考虑

### 素材分类建议

**星铁**：
- 角色（按角色名）
- 音乐（战斗/场景/系统）
- 立绘（角色/光锥/遗器）
- UI（图标/界面）
- 视频（PV/角色演示）
- 其他（字体/模型预览图）

### 搜索和筛选功能

- 按游戏版本、角色名称、稀有度、元素/命途、更新时间等维度筛选
- 支持关键词搜索文件名和描述

### 文件元数据管理

- 记录文件大小、格式、分辨率、时长、上传时间、游戏版本号、来源说明等信息

### 批量操作功能

- 管理员支持批量导入、批量编辑标签、批量删除
- 可能需要 Excel/CSV 导入功能

### 统计和监控

- 下载次数统计
- 热门素材排行
- 存储空间监控
- 每日访问量统计

### API 文档和开放接口

- 提供公开的 RESTful API 供第三方调用（如机器人、其他网站集成）

### 版本管理

- 同一素材可能有多个版本（如不同分辨率的图片），需要版本关联功能

### 备份策略

- 数据库定期备份
- 云盘文件清单本地备份
- 防止数据丢失

## 技术实现建议

### 前端框架
- React + TypeScript + Ant Design
- 或 Vue 3 + TypeScript + Element Plus

### 后端框架
- Express + TypeScript
- 使用 Prisma 或 TypeORM 作为 ORM

### 数据库
- PostgreSQL（结构化数据 + 全文搜索）
- 或 MySQL

### 认证方案
- JWT token
- 管理员单独的 admin token 或简单的账号密码

### 文件处理
- 使用 sharp 处理图片缩略图
- ffmpeg 提取音频元信息

### 部署方案
- 前端可部署到 Vercel/Netlify
- 后端部署到服务器或 Railway

## 优化建议

### 性能优化

#### 前端性能
- **图片懒加载**：使用 Intersection Observer 实现列表页图片懒加载
- **虚拟滚动**：素材列表较长时使用虚拟滚动（react-virtual 或 vue-virtual-scroller）
- **CDN 加速**：静态资源（缩略图、预览图）使用 CDN 缓存
- **代码分割**：按路由进行代码分割，减少首屏加载时间
- **预加载策略**：预加载下一页数据，提升翻页体验

#### 后端性能
- **数据库索引**：为常用查询字段（游戏ID、分类、标签、创建时间）添加索引
- **Redis 缓存**：热门素材列表、统计数据使用 Redis 缓存，减少数据库查询
- **分页优化**：使用游标分页代替传统的 offset 分页，提升大数据量翻页性能
- **API 限流**：使用 express-rate-limit 防止 API 滥用

### 用户体验优化

#### 浏览体验
- **面包屑导航**：清晰展示当前位置（首页 > 星穹铁道 > 音乐 > BGM）
- **快速筛选器**：顶部固定筛选条，支持多条件组合筛选
- **瀑布流布局**：图片素材使用瀑布流展示，更美观
- **骨架屏**：加载时显示骨架屏而非空白页面
- **键盘快捷键**：支持键盘操作（方向键切换、ESC 关闭预览等）

#### 详情页优化
- **相关推荐**：展示同角色/同类型的其他素材
- **分享功能**：生成分享链接，支持分享到社交平台
- **二维码下载**：移动端可扫码下载
- **下载前预览**：音频支持波形图展示，图片支持高清预览

#### 移动端适配
- **响应式设计**：完整适配手机、平板、桌面端
- **触摸手势**：支持左右滑动切换素材
- **PWA 支持**：添加 manifest.json，支持添加到主屏幕
- **离线提示**：网络断开时友好提示

### 管理后台优化

#### 上传体验
- **拖拽上传**：支持文件拖拽到窗口上传
- **上传队列**：显示上传进度和队列，支持暂停/取消
- **断点续传**：大文件支持断点续传
- **文件预览**：上传前可预览文件内容
- **批量编辑**：选中多个文件后批量设置标签和分类

#### 自动化功能
- **智能标签**：根据文件名自动识别角色名、版本号等信息
- **重复检测**：上传前检测是否已存在相同文件（MD5 校验）
- **图片压缩**：自动生成缩略图和多种尺寸的预览图
- **音频处理**：自动提取音频时长、比特率、封面等元信息

### 安全性优化

#### 文件安全
- **文件类型校验**：严格校验上传文件的 MIME 类型和扩展名
- **文件大小限制**：设置合理的单文件和总存储空间限制
- **恶意文件扫描**：集成病毒扫描（如 ClamAV）
- **防盗链**：下载链接添加时效性 token，防止直接盗链

#### 访问安全
- **HTTPS 强制**：全站启用 HTTPS
- **CORS 配置**：合理配置跨域策略
- **SQL 注入防护**：使用参数化查询（ORM 默认支持）
- **XSS 防护**：前端对用户输入进行转义
- **CSRF 防护**：管理后台添加 CSRF token
- **日志记录**：记录管理员操作日志，便于审计

### 数据库设计优化

#### 表结构建议
```sql
-- 游戏表
games (id, name, slug, icon, sort_order, is_active)

-- 分类表
categories (id, game_id, name, slug, parent_id, sort_order)

-- 素材表
materials (id, game_id, category_id, title, description, file_path, 
           file_size, file_type, duration, resolution, version, 
           upload_time, download_count, is_featured, status)

-- 标签表
tags (id, name, slug, type) -- type: character/element/rarity/version

-- 素材标签关联表
material_tags (material_id, tag_id)

-- 下载记录表
download_logs (id, material_id, ip, user_agent, download_time)

-- 管理员表
admins (id, username, password_hash, last_login, created_at)
```

#### 索引优化
- 为 `materials.game_id`, `materials.category_id`, `materials.status` 添加联合索引
- 为 `materials.upload_time`, `materials.download_count` 添加索引用于排序
- 为 `tags.slug`, `materials.title` 添加全文索引用于搜索

### 可维护性优化

#### 代码规范
- **TypeScript 严格模式**：开启 strict mode，提高类型安全
- **ESLint + Prettier**：统一代码风格
- **Git hooks**：使用 husky + lint-staged，提交前自动格式化和检查
- **单元测试**：核心业务逻辑编写单元测试（Jest）
- **API 文档**：使用 Swagger/OpenAPI 自动生成 API 文档

#### 环境配置
- **环境变量管理**：使用 .env 文件管理不同环境配置
- **配置验证**：启动时验证必需的环境变量是否存在
- **日志系统**：使用 Winston 或 Pino 记录结构化日志
- **错误监控**：集成 Sentry 进行错误追踪

#### 开发体验
- **热重载**：前后端开发时支持热重载
- **Mock 数据**：前端开发阶段使用 Mock 数据
- **Docker 支持**：提供 Dockerfile 和 docker-compose.yml
- **开发文档**：编写详细的 README 和开发文档

### SEO 优化

- **SSR/SSG**：考虑使用 Next.js 或 Nuxt.js 实现服务端渲染，提升 SEO
- **Meta 标签**：每个页面添加合适的 title、description、keywords
- **Sitemap**：自动生成 sitemap.xml
- **结构化数据**：添加 JSON-LD 结构化数据标记
- **语义化 HTML**：使用语义化标签，提升可访问性

### 监控和分析

- **访问统计**：集成 Google Analytics 或自建统计系统（Umami/Plausible）
- **性能监控**：使用 Lighthouse CI 定期检测性能指标
- **错误监控**：Sentry 实时监控前后端错误
- **服务器监控**：监控 CPU、内存、磁盘使用情况
- **告警机制**：关键错误发生时发送邮件/Webhook 通知

### 内容管理优化

#### 版本控制
- **版本历史**：记录素材的修改历史，支持回滚
- **草稿功能**：素材可保存为草稿，不立即发布
- **定时发布**：支持预约发布时间

#### 内容审核
- **审核工作流**：素材上传后需审核才能发布（可选）
- **内容标记**：可标记素材为"推荐"、"新品"、"热门"等

### 扩展性优化

#### 多语言支持
- **i18n 国际化**：使用 vue-i18n 或 react-i18next
- **语言切换**：支持中文/英文/日文切换
- **数据库多语言**：素材标题和描述支持多语言版本

#### 插件系统
- **预留扩展接口**：为未来可能的第三方集成预留接口
- **Webhook**：素材更新时触发 webhook，通知其他系统

#### 游戏扩展
- **模块化设计**：新增游戏时只需添加配置，不修改核心代码
- **游戏配置文件**：每个游戏的分类、标签等通过配置文件管理

